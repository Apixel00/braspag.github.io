<!DOCTYPE html>
<html lang="pt">
    <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="theme-color" content="#00aeef">
    <meta http-equiv="Content-Language" content="pt">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
        
        Manual de Integração &middot; Documentações e tutoriais
        
    </title>

    <link rel="shortcut icon" href="https://braspag.github.io//assets/favicon.ico">

    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">
    <script src="https://use.fontawesome.com/3ae06f1030.js"></script>
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/poole.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/syntax.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/hyde.css">

    <link rel="stylesheet" href="https://braspag.github.io//assets/css/bootstrap.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/jquery.tocify.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/jquery-ui.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/prettify.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/custom.css">
    <link rel="stylesheet" href="https://braspag.github.io//assets/css/braspag.css">

    
        
            <link rel="alternate" hreflang="pt" href="https://braspag.github.io//manual/split" />
        
    
        
            <link rel="alternate" hreflang="en" href="https://braspag.github.io//en/manual/split" />
        
    

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://braspag.github.io//atom.xml">
</head>

    <body>
        
        <div class="content-container">
            <div class="language-tabs">
                <a class='hide-btn' id="hide-button" title="Comutar"><i class="fa fa-bars" aria-hidden="true"></i></a>
                <ul class="language-buttons">
                    
                    <li><a data-language-name='json'>JSON</a></li>
                    
                </ul>
            </div>
            <div class="dark-box"></div>
            <div class="overlay"></div>
        
            <div id="submenu">
                <div class="submenu-container">
                    <div class="submenu-row sub-items">
                        <div class="submenu-itens">
                            <a href="http://www.braspag.com.br/fale-conosco/" class="help">Ajuda</a>

                            
                        </div>

                        
                        <div class="search">
                            <input type="text" class="search" id="input-search">
                        </div>
                    </div>
                    <div class="submenu-row results">
                        <div class="search-results-container">
                            <ul class="search-results"></ul>
                        </div>
                    </div>
                        

                    <div class="submenu-row breads">
                        <ol class="breadcrumb">
                            
                            <li><a href="/">Início</a></li>
                            
                            
                            
                            
                                
                                    
                                    
                                    
                                    
                                    
                                        
                                    
                                        
                                    
                                        
                                    
                                
                            
                                
                                    
                                    <li class="active">&gt; <a href="https://braspag.github.io//manual/split">Manual de Integração</a></li>
                                    
                                
                            
                        </ol>
                    </div>
                </div>
            </div>

            <div class="post">
  <h1 id="introdução">Introdução</h1>

<p>O Split de Pagamentos permite a divisão de uma transação entre diferentes participantes de uma venda.</p>

<p>Muito utilizado em Marketplaces, onde <strong>o carrinho é composto por produtos de diferentes fornecedores</strong> e o valor total da venda deve ser dividido entre os participantes.</p>

<table>
  <thead>
    <tr>
      <th><strong>Participantes</strong></th>
      <th><strong>Descrição</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Marketplace</strong></td>
      <td>Responsável pelo carrinho. <br /> Possui <strong>Subordinados</strong> que fornecem os produtos presentes no carrinho.<br /> Define um MDR* e uma Tarifa Fixa (opcional) a serem descontados sobre a venda do <strong>Subordinado</strong>.<br /></td>
    </tr>
    <tr>
      <td><strong>Subordinado</strong></td>
      <td>Fornecedor dos produtos que compõem o carrinho.<br />Recebe parte do valor da venda, descontado o MDR* acordado com o <strong>Marketplace</strong>.<br /></td>
    </tr>
    <tr>
      <td><strong>Braspag (Facilitador)</strong></td>
      <td>Responsável pelo fluxo transacional.<br /> Define um MDR* e uma Tarifa Fixa a serem descontados sobre o valor total da venda realizada pelo <strong>Marketplace</strong>.<br /> Responsável pela liquidação dos pagamentos para os <strong>Subordinados</strong> e <strong>Marketplace</strong>.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>MDR</strong>  (<em>Merchant Discount Rate</em>): Percentual a ser descontado sobre o valor de uma transação.</p>
</blockquote>

<h2 id="como-funciona-o-split-de-pagamentos">Como funciona o Split de Pagamentos?</h2>

<p>No Split de Pagamentos o responsável pelo fluxo transacional é o facilitador.</p>

<p>O Marketplace se integra à Braspag para transacionar e informa como será dividida a transação entre cada participante, podendo ser no momento de captura ou em um momento posterior, conhecido como split pós-transacional, desde que seja dentro de um limite de tempo pré-estabelecido.</p>

<p>Com a transação capturada, a Braspag calcula o valor destinado a cada participante e repassa esses valores, no prazo estabelecido de acordo com cada produto (regime de pagamento*), para cada envolvido na transação.</p>

<aside class="notice">
**Regime de Pagamento**: Prazo estabelecido para liquidação de acordo com o produto (crédito ou débito) e bandeira.<br />
**Crédito**: Em até 31 dias.<br />
**Crédito** Parcelado: 1º parcela em até 31 dias, demais a cada 30.<br />
**Débito**: Em até 1 dia útil<br />
<aside>

Para utilizar o Split de Pagamentos, o **Marketplace** deverá se cadastrar na Braspag juntamente com seus **Subordinados**. Após este processo, tanto o **Marketplace** quanto seus **Subordinados** possuirão um identificador único, conhecido como **MerchantId (MID)**, que deverá ser utlizado ao informar as regras de divisão de uma transação.

A divisão de uma transação deve serguir as seguintes regras:

* Informar os identificadores dos **Subordinados**.
* Os valores de participação de cada **Subordinado**. O somatório deverá ser igual ao valor total da transação.
* MDRs + Tarifas Fixas (opcional) a serem aplicados sobre o valor de cada **Subordinado** que será destinado ao **Marketplace**. Deverá ser acordado previamente entre o **Marketplace** e o **Subordinado**.

O **Marketplace** também pode ser um participante da divisão. Para isso basta informar seu identificador na divisão, passando o mesmo a ter também o papel de **Subordinado** e ter seus próprios produtos no carrinho.

## Taxas

As taxas acordadas entre os participantes, que são o **MDR(%)** e uma **Taxa Fixa(R$)**, devem ser definidas no momento do cadastro do **Marketplace** e dos seus **Subordinados** junto à Braspag.  

As mesmas poderão ser enviadas no momento transacional ou pós-transacional. Caso não sejam enviadas, a **Braspag** irá considerar as taxas já cadastradas.   

### Braspag (Facilitador)

A Braspag acordará um **MDR(%)** e uma **Tarifa Fixa(R$)** com o **Marketplace** a serem descontados em cada transação.

O **Marketplace**, de conhecimento destas taxas, negociará o seu **MDR(%)** e uma **Tarifa Fixa(R$)(opcional)** juntamente com seus **Subornidandos**, já embutindo o **MDR(%)** acordado junto à **Braspag**.

O desconto da **Tarifa Fixa(R$)**, acordado entre o **Marketplace** e a **Braspag**, não é aplicado no valor total da transação, não entrando no cálculo da divisão e sim sendo debitado do montante que o **Marketplace** tem para receber junto à **Braspag**. O **MDR(%)** entra no cálculo de divisão da transação, já que o mesmo deve estar embutido no **MDR(%)** acordado entre o **Marketplace** e seus **Subordinados.**

&gt; **Custo para o Marketplace:** MDR Braspag(%) + Tarifa Fixa(R$)
&gt; O **MDR(%)** acordado entre um **Marketplace** e um **Subordinado** deve ser sempre maior que o **MDR(%)** acordado entre a **Braspag** e o **Marketplace**.

### Marketplace

O **Marketplace** é responsável por acordar as taxas a serem cobradas de seus **Subordinados**, onde deve ser defindo um **MDR(%)** maior ou igual ao **MDR(%)** definido entre a **Braspag** e o **Marketplace** e uma **Tarifa Fixa(R$)**, que é opcional.

&gt; **Custo para o Subordinado:** MDR Marketplace(%) + Tarifa Fixa(R$), onde no MDR Marketplace(%) está embutido o MDR Braspag(%).

Exemplo

Uma transação de **R$100**, realizada por um **Marketplace** com participação do **Subordinado 01**.

![Split](https://docsbraspag.github.io/SplitBraspag/images/Split/Split000.PNG)

Neste exemplo, foram assumidos os seguintes acordos:

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.

Após o split, cada participante terá sua agenda sensibilizada com os seguintes eventos:

**Subordinado**:  
Crédito: R$94,70 = (R$100 - 5%) - R$0,30.

**Marketplace**:  
Crédito: R$3,30 = R$100 * (5% - 2%) + R$0,30.  
Débito: R$0,30 (Tarifa Fixa Braspag)

**Braspag (Facilitador)**:  
Crédito: R$2,00 = R$100 * 2%.  
Crédito: R$0,30 (Tarifa Fixa Braspag)

## Utilizando o Split de Pagamentos

<br />
O Split de Pagamentos é parte da API Cielo E-Commerce, desenvolvida utilizando a arquitetura REST e JSON como mensageria. Para mais informações sobre a API Cielo E-Commerce, consulte o [Manual de Integração](https://developercielo.github.io/Webservice-3.0/#criando-uma-transação-simples){:target="_blank"} da Plataforma.

OBS: Neste manual serão apresentados os contratos de integração da API Cielo E-Commerce, porém o foco da análise será nas operações referentes ao Split de Pagamentos.

### Ambientes

&gt; **SANDBOX**
&gt;
&gt; **API Cielo E-Commerce**:  
&gt; https://apisandbox.cieloecommerce.cielo.com.br/
&gt;
&gt; **API Cielo E-Commerce (Consulta)**:  
&gt; https://apiquerysandbox.cieloecommerce.cielo.com.br/
&gt;
&gt; **API Split**:  
&gt; http://splitsandbox.braspag.com.br/
&gt;
&gt; **OAUTH2 Server**:  
&gt; https://authhomolog.braspag.com.br/

### Autorização  

A autorização de uma transação no Split de Pagamentos deve ser realizada através da API Cielo E-Commerce seguindo os mesmos contratos descritos na documentação da plataforma.

Porém, para indentificar que a transação enviada se trata de uma transação de Split de Pagamentos, deve-se modificar o tipo de pagamento utilizado, conforme abaixo:

|=                     | **Cartão de Crédito** | **Cartão de Débito**  |
|---------------------|------------------------|-----------------------|
| **Transação Comum** | CreditCard             | DebitCard             |
| **Transação Split** | SplittedCreditCard     | SplittedDebitCard     |

&gt; Atualmente o Split de Pagamentos está disponivel para os seguintes tipos de pagamento:
&gt; * Cartão de Crédito  
&gt; Em breve estarão disponíveis:
&gt; * Cartão de Débito
&gt; * Boleto

Exemplo:

```json
{
   "MerchantOrderId":"2014111703",
   "Customer":{
      "Name":"Comprador crédito simples"
   },
   "Payment":{
     "Type":"SplittedCreditCard",
     "Amount":10000,
     "Installments":1,
     "SoftDescriptor":"123456789ABCD",
     "CreditCard":{
         "CardNumber":"1234123412341231",
         "Holder":"Teste Holder",
         "ExpirationDate":"12/2030",
         "SecurityCode":"123",
         "Brand":"Visa"
     }
   }
}
```

Ao informar um tipo de pagamento referente ao Split, a API Cielo e-Commerce automaticamente identifica que a transação é referente ao Split de Pagamentos e realiza o fluxo transacional pela Braspag (Facilitador).

Caso a transação enviada seja marcada para captura automática, o nó contendo as regras de divisão deverá ser enviado, caso contrário a transação será dividida entre a **Braspag** e o **Marketplace**. Posteriormente é permitido que o **Marketplace** envie novas regras de divisão para a transação através da API de divisão pós-transacional, desde que esteja dentro do período de tempo permitido.

**Exemplo 1)**  

Transação no valor de **R$100,00** sem o nó contendo as regras de divisão.

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.

```json
{
   "MerchantOrderId":"2014111703",
   "Customer":{
      "Name":"Comprador crédito simples"
   },
   "Payment":{
     "Type":"SplittedCreditCard",
     "Amount":10000,
     "Capture":true,
     "Installments":1,
     "SoftDescriptor":"123456789ABCD",
     "CreditCard":{
         "CardNumber":"1234123412341231",
         "Holder":"Teste Holder",
         "ExpirationDate":"12/2030",
         "SecurityCode":"123",
         "Brand":"Visa"
     }
   }
}
```

Neste caso o **Marketplace** recebe o valor da transação descontado o MDR acordado com a **Braspag**. Como apresentado anteriormente, a Tarifa Fixa acordada entre o **Marketplace** e a **Braspag** é sensibilizada diretamente na agenda.

![Split](https://docsbraspag.github.io/SplitBraspag/images/Split/Split001.PNG)

**Exemplo 2)**  

Transação no valor de **R$100,00** com o nó contendo as regras de divisão.

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 01**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 02**: 4% MDR, já embutindo os 2% do MDR Braspag + 0,15 Tarifa Fixa.  

```json
{
   "MerchantOrderId":"2014111703",
   "Customer":{
      "Name":"Comprador crédito simples"
   },
   "Payment":{
     "Type":"SplittedCreditCard",
     "Amount":10000,
     "Capture":true,
     "Installments":1,
     "SoftDescriptor":"123456789ABCD",
     "CreditCard":{
         "CardNumber":"1234123412341231",
         "Holder":"Teste Holder",
         "ExpirationDate":"12/2030",
         "SecurityCode":"123",
         "Brand":"Visa"
     },
     "SplitPayments":[
        {
            "SubordinateMerchantId" :"MID Subordinate 01",
            "Amount":6000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            }
        },
        {
            "SubordinateMerchantId" :"MID Subordinate 02",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":15
            }
        }
     ]
   }
}
```

Neste caso o cálculos do Split são realizados sobre cada regra de divisão informada. No próximo tópico serão explicados as propriedades que compõem o nó do Split de Pagamentos.

![Split](https://docsbraspag.github.io/SplitBraspag/images/Split/Split003.PNG)

### Modelos de Split

O Split de Pagamentos possui dois modelos básicos de integração:

| Tipo                 | Descrição                                                                                                                          |
|----------------------|------------------------------------------------------------------------------------------------------------------------------------|
| **Split Transacional**     | O **Marketplace** envia na autorização (captura automática) ou no momento de captura as regras de divisão.                                             |
| **Split Pós-Transacional** | O **Marketplace** envia as regras de divisão após a captura da transação.

&gt; O Split de Pagamentos só é realizado para transações capturadas, ou seja, o mesmo só será considerado para autorizações com captura automática e no momento da captura de uma transação. Caso seja informado no momento de uma autorização sem captura automática, as regras de divisão serão desconsideradas.

<br />

#### Split Transacional

<br />
Este modelo exige que o **Marketplace** envie um "nó" adicional na integração da API Cielo E-Commerce, como apresentado em exemplos anteriores, informando as regras de divisão da transação.

```json
"SplitPayments":[
    {
        "SubordinateMerchantId" :"MID Subordinate 01",
        "Amount":10000,
        "Fares":{
            "Mdr":5,
            "Fee":0
        }
    }
]
```

| Propriedade                             | Descrição                                                                                   | Tipo   | Tamanho | Obrigatório |
|-----------------------------------------|---------------------------------------------------------------------------------------------|--------|---------|-------------|
| `SplitPayments.SubordinateMerchantId`   | **MerchantId** (Identificador) do **Subordinado**.                                                           | Guid   | 36      | Sim         |
| `SplitPayments.Amount`                  | Parte do valor total da transação referente a participação do **Subordinado**, em centavos.              | Inteiro | -      | Sim         |
| `SplitPayments.Fares.Mdr`               | **MDR(%)** do **Marketplace** a ser descontado do valor referente a participação do **Subordinado** | Decimal | -       | Sim         |
| `SplitPayments.Fares.Fee`               | **Tarifa Fixa(R$)** a ser descontada do valor referente a participação do **Subordinado**, em centavos.  | Inteiro | -      | Sim         |

Como resposta, A API Cielo E-Commerce retornará na resposta um nó contento as regras de divisão enviadas e os valores a serem recebidos pelo **Marketplace** e seus **Subordinados**:

```json
"SplitPayments": [
    {
        "SubordinateMerchantId": "MID Subordinate 01",
        "Amount": 10000,
        "Fares": {
            "Mdr": 5,
            "Fee": 0
        },
        "Splits": [                
            {
                "MerchantId": "MID do Marketplace",
                "amount": 500,
            },
            {
                "MerchantId": "MID Subordinate 01",
                "amount": 9500,
            }
        ]
    }
]
```

| Propriedade                             | Descrição                                                                                   | Tipo   | Tamanho | Obrigatório |
|-----------------------------------------|---------------------------------------------------------------------------------------------|--------|---------|-------------|
| `SplitPayments.Splits.SubordinateMerchantId` | **MerchantId** (Identificador) do **Subordinado** ou **Marketplace**.                                            | Guid   | 36      | Sim         |
| `SplitPayments.Splits.Amount`            | Parte do valor calculado da transação a ser recebido pelo **Subordinado** ou **Marketplace**, já descontando todas as taxas (MDR e Tarifa Fixa) | Inteiro | -      | Sim         |

**Exemplo**  

Transação no valor de **R$100,00** com o nó contendo as regras de divisão.

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 01**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 02**: 4% MDR, já embutindo os 2% do MDR Braspag + 0,15 Tarifa Fixa.  

`REQUEST`

```json
{
   "MerchantOrderId":"2014111703",
   "Customer":{
      "Name":"Comprador crédito simples"
   },
   "Payment":{
     "Type":"SplittedCreditCard",
     "Amount":10000,
     "Capture":true,
     "Installments":1,
     "SoftDescriptor":"123456789ABCD",
     "CreditCard":{
         "CardNumber":"1234123412341231",
         "Holder":"Teste Holder",
         "ExpirationDate":"12/2030",
         "SecurityCode":"123",
         "Brand":"Visa"
     },
     "SplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "Amount":6000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            }
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":15
            }
        }
     ]
   }
}
```

`RESPONSE`

```json
{
    "MerchantOrderId": "2014111706",
    "Customer": {
        "Name": "Comprador crédito simples"
    },
    "Payment": {
        "ServiceTaxAmount": 0,
        "Installments": 1,
        "Interest": "ByMerchant",
        "Capture": true,
        "Authenticate": false,
        "CreditCard": {
            "CardNumber": "455187******0183",
            "Holder": "Teste Holder",
            "ExpirationDate": "12/2030",
            "SaveCard": false,
            "Brand": "Visa"
        },
        "ProofOfSale": "674532",
        "Tid": "0305023644309",
        "AuthorizationCode": "123456",
        "PaymentId": "24bc8366-fc31-4d6c-8555-17049a836a07",
        "Type": "CreditCard",
        "Amount": 10000,
        "Currency": "BRL",
        "Country": "BRA",
        "ExtraDataCollection": [],
        "Status": 1,
        "ReturnCode": "4",
        "ReturnMessage": "Operation Successful",
        "SplitPayments":[
            {
                "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
                "Amount":6000,
                "Fares":{
                    "Mdr":5,
                    "Fee":30
                },
                "Splits": [
                    {
                        "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                        "amount": 210,    
                    },
                    {
                        "MerchantId": "0f377932-5668-4c72-8b5b-2b43760ebd38",
                        "amount": 5670,    
                    }
                ]
            },
            {
                "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
                "Amount":4000,
                "Fares":{
                    "Mdr":4,
                    "Fee":15
                },
                "Splits": [
                    {
                        "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                        "amount": 95,    
                    },
                    {
                        "MerchantId": "98430463-7c1e-413b-b13a-0f613af594d8",
                        "amount": 3825,    
                    }
                ]
            }
        ],
        "Links": [
            {
                "Method": "GET",
                "Rel": "self",
                "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
            },
            {
                "Method": "PUT",
                "Rel": "capture",
                "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/capture"
            },
            {
                "Method": "PUT",
                "Rel": "void",
                "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/void"
            }
        ]
    }
}
```

Neste exemplo os cálculos do Split foram realizados sobre cada regra de divisão informada e na resposta retornaram os valores a serem recebidos pelo **Marketplace** e seus **Subordinados**.

![Split](https://docsbraspag.github.io/SplitBraspag/images/Split/Split003.PNG)

Divisão do valor do Subordinado **0f377932-5668-4c72-8b5b-2b43760ebd38**:

**Marketplace**: R$2,10  
**Subordinado**: R$56,70  

Divisão do valor do Subordinado **98430463-7c1e-413b-b13a-0f613af594d8**:

**Marketplace**: R$0,95  
**Subordinado**: R$38,25  

#### Split Pós-Transacional

<br />
Neste modelo o **Marketplace** poderá enviar as regras de divisão da transação após a mesma ser capturada.

A divisão pós-transacional é possível somente para transações com **Cartão de Crédito** e poderá ser realizada dentro de um intervalo de tempo a partir da data de captura da transação.

Para transações com **Cartão de Crédito**, este período é de **25 dias** se o **Marketplace** possuir um regime padrão de pagamentos. Caso tenha um regime personalizado, o período deverá ser acordado entre as partes (**Marketplace** e **Braspag**).

A API de divisão pós-transacional utiliza como segurança o protocolo [OAUTH2](https://oauth.net/2/){:target="_blank"}, onde é necessário primeiramente obter um token utlizando suas credenciais, que deverá posteriormente ser enviado à API do Split para realização da divisão pós-transacional.

Para obter um token de acesso:

1. Concatene o ClientId e ClientSecret: `ClientId:ClientSecret`.  
2. Codifique o resultado da concatenação em Base64.  
3. Realize uma requisição ao servidor de autorização:  

`REQUEST`  

```json
POST https://{OAUTH2 Server}/oauth2/token  
--header "Authorization: Basic {base64}"  
--header "Content-Type: application/x-www-form-urlencoded"  
grant_type=client_credentials
```

`RESPONSE`

```json
{
    "access_token": "eyJ0eXAiOiJKV1QiLCJhbG.....WE1igNAQRuHAs",
    "token_type": "bearer",
    "expires_in": 1199
}
```

&gt; O ClientId é o mesmo utilizado na integração com a API Cielo E-Commerce, conhecido como MerchantId. O ClientSecret deve ser obtido junto à Braspag.

O token retornado (access_token) deverá ser utilizado em toda requisição à API do Split como uma chave de autorização. O mesmo possui uma validade de 20 minutos e deverá ser obtido um novo token toda vez que o mesmo expirar.  

Com o token de acesso, é possível realizar um requisição à API do Split para enviar as regras de divisão de uma transação.  

`REQUEST`  

```json
PUT https://{API Split}/api/transactions/{PaymentId}/split
--header "Authorization: Bearer {token}"
```

```json
[
    {
        "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
        "Amount":6000,
        "Fares":{
            "Mdr":5,
            "Fee":30
        }
    },
    {
        "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
        "Amount":4000,
        "Fares":{
            "Mdr":4,
            "Fee":15
        }
    }
]
```

RESPONSE

```json
[
    {
        "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
        "Amount":6000,
        "Fares":{
            "Mdr":5,
            "Fee":30
        },
        "Splits": [
            {
                "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                "amount": 210,    
            },
            {
                "MerchantId": "0f377932-5668-4c72-8b5b-2b43760ebd38",
                "amount": 5670   
            }
        ]
    },
    {
        "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
        "Amount":4000,
        "Fares":{
            "Mdr":4,
            "Fee":0.15
        },
        "Splits": [
            {
                "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                "amount": 95,    
            },
            {
                "MerchantId": "98430463-7c1e-413b-b13a-0f613af594d8",
                "amount": 3825    
            }
        ]
    }
]
```

Exemplo considerando transação no valor de **R$100,00** e as seguinte taxas:

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 01**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 02**: 4% MDR, já embutindo os 2% do MDR Braspag + 0,15 Tarifa Fixa.  

O nó de Split de Pagamentos da API pós-transacional, no contrato de request e response, é o mesmo retornado na divisão no momento transacional, apresentado anteriormente.

&gt; O **Marketplace** poderá informar as regras de divisão da transação mais de uma vez desde que esteja dentro do período de tempo permitido, que é de **25 dias** para Cartão de Crédito. Para transações com Cartão de Débito a divisão poderá ser realizada somente no momento transacional.

### Consulta

Para consultar uma transação, utilize o próprio serviço de consulta da API Cielo E-Commerce.

`REQUEST`

```json
GET https://{API Cielo E-Commerce (consulta)}/1/sales/{PaymentId}
```

`RESPONSE`

```json
{
    "MerchantOrderId": "2014111706",
    "Customer": {
        "Name": "Comprador Teste"
    },
    "Payment": {
        "ServiceTaxAmount": 0,
        "Installments": 1,
        "Interest": "ByMerchant",
        "Capture": false,
        "Authenticate": false,
        "CreditCard": {
            "CardNumber": "455187******0183",
            "Holder": "Teste Holder",
            "ExpirationDate": "12/2030",
            "SaveCard": false,
            "Brand": "Visa"
        },
        "ProofOfSale": "674532",
        "AuthorizationCode": "123456",
        "PaymentId": "24bc8366-fc31-4d6c-8555-17049a836a07",
        "Type": "CreditCard",
        "Amount": 1000,
        "Currency": "BRL",
        "Country": "BRA",
        "ExtraDataCollection": [],
        "Status": 2,
        "SplitPayments":[
            {
                "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
                "Amount":6000,
                "Fares":{
                    "Mdr":5,
                    "Fee":30
                },
                "Splits": [
                    {
                        "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                        "amount": 210,    
                    },
                    {
                        "MerchantId": "0f377932-5668-4c72-8b5b-2b43760ebd38",
                        "amount": 5670,    
                    }
                ]
            },
            {
                "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
                "Amount":4000,
                "Fares":{
                    "Mdr":4,
                    "Fee":15
                },
                "Splits": [
                    {
                        "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                        "amount": 95,    
                    },
                    {
                        "MerchantId": "98430463-7c1e-413b-b13a-0f613af594d8",
                        "amount": 3825,    
                    }
                ]
            }
        ],
        "Links": [
            {
                "Method": "GET",
                "Rel": "self",
                "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
            },
            {
                "Method": "PUT",
                "Rel": "capture",
                "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/capture"
            },
            {
                "Method": "PUT",
                "Rel": "void",
                "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/void"
            }
        ]
    }
}
```

### Captura

Ao capturar uma transação do Split de Pagamentos o **Marketplace** deve informar as regras de divisão da mesma. Caso não informe, será gerada a divisão da transação entre o **Marketplace** e a **Braspag**, tanto para **captura do valor total** quanto para **captura de um valor parcial**.

#### Captura Total

Na captura total de uma transação, o somatório dos valores de participação de cada subordinado deverá ser igual ao valor total da transação enviado no momento da autorização.

`REQUEST`

```json
PUT https://{API Cielo E-Commerce}/1/sales/{PaymentId}/capture
{
    "SplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "Amount":6000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            }
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":15
            }
        }
     ]
}
```

`RESPONSE`

```json
{
    "Status": 2,
    "ReturnCode": "6",
    "ReturnMessage": "Operation Successful",
    "SplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "Amount":6000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            },
            "Splits": [
                {
                    "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                    "amount": 210,    
                },
                {
                    "MerchantId": "0f377932-5668-4c72-8b5b-2b43760ebd38",
                    "amount": 5670,    
                }
            ]
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":15
            },
            "Splits": [
                {
                    "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                    "amount": 95,    
                },
                {
                    "MerchantId": "98430463-7c1e-413b-b13a-0f613af594d8",
                    "amount": 3825,    
                }
            ]
        }
    ]
    "Links": [
        {
            "Method": "GET",
            "Rel": "self",
            "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
        },
        {
            "Method": "PUT",
            "Rel": "void",
            "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/void"
        }
    ]
}
```

Exemplo considerando transação no valor de **R$100,00** e as seguinte taxas:

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 01**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 02**: 4% MDR, já embutindo os 2% do MDR Braspag + 0,15 Tarifa Fixa.

#### Captura Parcial

Na captura parcial de uma transação, o somatório dos valores de participação de cada subordinado deverá ser igual ao valor total a ser capturado.

`REQUEST`

```json
PUT https://{API Cielo E-Commerce}/1/sales/{PaymentId}/capture?amount=8000
{
    "SplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "Amount":4000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            }
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":15
            }
        }
     ]
}
```

`RESPONSE`

```json
{
    "Status": 2,
    "ReturnCode": "6",
    "ReturnMessage": "Operation Successful",
    "SplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "Amount":4000,
            "Fares":{
                "Mdr":5,
                "Fee":30
            },
            "Splits": [
                {
                    "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                    "amount": 150,    
                },
                {
                    "MerchantId": "0f377932-5668-4c72-8b5b-2b43760ebd38",
                    "amount": 3770,    
                }
            ]
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "Amount":4000,
            "Fares":{
                "Mdr":4,
                "Fee":0.15
            },
            "Splits": [
                {
                    "MerchantId": "cd16ab8e-2173-4a16-b037-36cd04c07950",
                    "amount": 95,    
                },
                {
                    "MerchantId": "98430463-7c1e-413b-b13a-0f613af594d8",
                    "amount": 3825,    
                }
            ]
        }
    ]
    "Links": [
        {
            "Method": "GET",
            "Rel": "self",
            "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
        },
        {
            "Method": "PUT",
            "Rel": "void",
            "Href": "https://apisandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}/void"
        }
    ]
}
```

Exemplo considerando transação no valor de **R$100,00**, captura parcial de **R$80,00** e as seguintes taxas:

**Taxa Braspag**: 2% MDR + R$0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 01**: 5% MDR, já embutindo os 2% do MDR Braspag + 0,30 Tarifa Fixa.  
**Taxa Marketplace com o Subordinado 02**: 4% MDR, já embutindo os 2% do MDR Braspag + 0,15 Tarifa Fixa.

### Cancelamento

Ao cancelar uma transação do Split de Pagamentos o **Marketplace** deve informar, para um cancelamento parcial, qual o valor deve ser cancelado de cada **Subpordinado** que participa da transação. Para um cancelamento total esta informação não é necessária, já que será cancelado o valor total e consequentemente o valor total de cada **Subpordinado**.

#### Cancelamento Total

<br />
No cancelamento total de uma transação, será cancelado o valor total da transação e consequentemente o valor total de cada **Subordinado**.

`REQUEST`

```
PUT https://{API Cielo E-Commerce}/1/sales/{PaymentId}/void
```

`RESPONSE`

```json
{
    "Status": 10,
    "ReturnCode": "9",
    "ReturnMessage": "Operation Successful",
    "VoidSplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "VoidAmount":1500,
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "VoidAmount":500,
        }
    ]
    "Links": [
        {
            "Method": "GET",
            "Rel": "self",
            "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
        }
    ]
}
```

#### Cancelamento Parcial

<br />
No cancelamento parcial, o somatório dos valores cancelados definidos para cada **Subordinado** não poderão ultrapassar o valor total do cancelamento parcial.  

Os valores cancelados serão sensibilizados nas respectivas agendas dos **Subordinados**.

`REQUEST`

```json
PUT https://{API Cielo E-Commerce}/1/sales/{PaymentId}/void?amount=2000
{
    "VoidSplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "VoidAmount":1500,
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "VoidAmount":500,
        }
     ]
}
```

`RESPONSE`

```json
{
    "Status": 2,
    "ReasonCode": 0,
    "ReasonMessage": "Successful",
    "ProviderReturnCode": "0",
    "ProviderReturnMessage": "Operation Successful",
    "ReturnCode": "0",
    "ReturnMessage": "Operation Successful",
    "VoidSplitPayments":[
        {
            "SubordinateMerchantId" :"0f377932-5668-4c72-8b5b-2b43760ebd38",
            "VoidAmount":1500,
        },
        {
            "SubordinateMerchantId" :"98430463-7c1e-413b-b13a-0f613af594d8",
            "VoidAmount":500,
        }
    ],
    "Links": [
        {
            "Method": "GET",
            "Rel": "self",
            "Href": "https://apiquerysandbox.cieloecommerce.cielo.com.br/1/sales/{PaymentId}"
        }
    ]
}
```

## Agenda

&gt; Em breve disponibilizaremos a API de Agenda onde será possível consultar a agenda do **Markectplace** e seus **Subordinados**.
</aside></aside>

</div>


            <div class="footer-conteudo">
    <div id="footer-conteudo-img" class="col-lg-1 col-md-1">
            <img src="https://braspag.github.io//assets/images/icon-doubt.svg" width="55px" height="53px" alt="Precisa de ajuda?">
    </div>

    <div id="footer-conteudo-texto" class="col-lg-11 col-md-11">
        <h2>Precisa de ajuda?</h2>
        <p>Se você não conseguiu encontrar sua resposta acima, <a href="http://www.braspag.com.br/fale-conosco/">entre em contato conosco</a>.</p>
    </div>
</div>

        </div>

        <div class="sidebar">
  <div class="sidebar-sticky">
    <div class="sidebar-about">
      <a title="Comutar a coluna da esquerda" class="hamburger">
        <i class="fa fa-bars hamb-menu" aria-hidden="true"></i>
      </a>
      <a href="https://braspag.github.io//">
        <img src="https://braspag.github.io//assets/images/logo.png" alt="Documentações e tutoriais">
      </a>
      <div></div>
    </div>

    <div id="toc"></div>

    <div class="fixed-footer">
        

    <div class="toc-contact">
      <div class="contact">
        <a title="Contato" href="http://www.braspag.com.br/fale-conosco/">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          <span>Contato</span>
        </a>
      </div>
      <div class="github">
        <a title="GitHub" href="https://github.com/braspag">
          <i class="fa fa-github" aria-hidden="true"></i>
          <span>GitHub</span>
        </a>
      </div>
    </div>
  </div>
  </div>
</div>


        <script src="https://braspag.github.io//assets/js/jquery.min.js"></script>
        <script src="https://braspag.github.io//assets/js/jquery-ui-1.9.1.custom.min.js"></script>
        <script src="https://braspag.github.io//assets/js/bootstrap.js"></script>
        <script src="https://braspag.github.io//assets/js/jquery.tocify.js"></script>
        <script src="https://braspag.github.io//assets/js/prettify.js"></script>
        <script>
        $(function() {
            var openedHeader = null;

            $("#toc").tocify({
                
                selectors: "h1,h2,h3,h4,h5,h6",
                
                hashGenerator: "pretty",
                ignoreSelector: ".no-toc",
                scrollTo: 100,
                smoothScroll: false,
                showEffect: "none"
            }).data("toc-tocify");

            $('ul').prev('li').addClass('has-subitens');
            $(window).scroll(function () {
                if ($('li.active').closest('.tocify-header') !== openedHeader) {
                    $('li.is-open').removeClass('is-open');

                    openedHeader = $('li.active').closest('.tocify-header');
                }

                openedHeader.find('ul:visible').prev('li').addClass('is-open');
            });

            $('.hamburger').click(function() {
                $('body').toggleClass('sidebar-closed');
            });

            $('.code-menu').click(function() {
                $('body').toggleClass('code-menu-closed');
            });

            prettyPrint();
        });
        </script>

        
        <script src="https://braspag.github.io//assets/js/jquery.highlight.js"></script>
        <script src="https://braspag.github.io//assets/js/lunr.js"></script>
        <script src="https://braspag.github.io//assets/js/search.js"></script>
        

        
        <script>
        let langs = '';

        $('div.highlighter-rouge').prepend( '<a class="fa expand-btn" title="Comutar"><i class="fa fa-expand" aria-hidden=true></i></a>' );
        $('div.highlighter-rouge').each(function (index) {
            if(!$(this).parent().hasClass('language-group')) {
                $(this).first().next('div.highlighter-rouge').andSelf().wrapAll('<div class="code-fullscreen"><div class="language-group"></div></div>');
            }
        });

        $('.content-container:not(.no-dark-box) div.highlighter-rouge').each(function (index) {
            let height = $(this).outerHeight();

            $(this).parent().parent().next('table').wrapAll('<div class="table-wrap" style="min-height:' + height + 'px;"></div> ');
        });

        $('.hide-btn').click(function() {
            $('.content-container').toggleClass('no-dark-box');
            $('.dark-box').toggle();

            $('.overlay').removeClass('opened');
            $('.code-fullscreen').removeClass('opened');
        });

        $('.expand-btn').click(function() {
            $('.overlay').toggleClass('opened');
            $(this).parent().parent().parent().toggleClass('opened');
            $(this).children('i.fa').toggleClass('fa-compress');
        });

        
        langs += "<a data-language-name='json'>JSON</a>";
        

        $('.language-group').prepend('<div class="language-buttons">' + langs + '</div>');
        </script>

        <script src="https://braspag.github.io//assets/js/lang.js"></script>
        <script>
            $(function() {
                setupLanguages([  "json", ]);
            });
        </script>
        

        <!-- Hotjar Tracking Code for https://braspag.github.io/ -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:715256,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>

    </body>
</html>
